WITH holidays_array AS (
SELECT ARRAY_TO_STRING(ARRAY_AGG(to_char(HOLIDAY, 'YYYY-MM-DD')), ',') AS HOLIDAYS
FROM FUNDPERFECT_ACTIVE.PUBLIC.HOLIDAYS
)

SELECT workday('2023-01-06', '1',(SELECT HOLIDAYS FROM holidays_array)) as next_workday

FROM FUNDPERFECT_ACTIVE.PUBLIC.FP_DAILY_CONTRACT_EXTRACT;
